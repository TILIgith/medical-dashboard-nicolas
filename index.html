<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graf v√°hy</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: white;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        
        body.login-mode {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .login-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            padding: 40px;
            max-width: 400px;
            width: 100%;
            text-align: center;
        }
        
        .login-container h2 {
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 24px;
        }
        
        .login-container input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 20px;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }
        
        .login-container input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .login-container button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .login-container button:hover {
            transform: translateY(-2px);
        }
        
        .login-container button:active {
            transform: translateY(0);
        }
        
        .error-message {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 10px;
            display: none;
        }
        
        .info-text {
            color: #7f8c8d;
            font-size: 12px;
            margin-top: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            padding: 30px;
            display: none;
        }
        
        .logout-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            background: rgba(231, 76, 60, 0.9);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            z-index: 1000;
            display: none;
        }
        
        .logout-btn:hover {
            background: rgba(231, 76, 60, 1);
        }
        
        .chart-wrapper {
            position: relative;
            height: 600px;
            margin-bottom: 30px;
        }
        
        .legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 20px;
            font-size: 11px;
        }
        
        .legend-item.endoscopy { order: 1; }
        .legend-item.diarrhea { order: 2; }
        .legend-item.hospitalization { order: 3; }
        .legend-item.medication { order: 4; }
        
        .legend-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            flex-shrink: 0;
        }
        
        .legend-text {
            font-size: 10px;
            line-height: 1.3;
        }
        
        .hospitalization { border-left-color: #e74c3c; }
        .endoscopy { border-left-color: #3498db; }
        .diarrhea { border-left-color: #f39c12; }
        .medication { border-left-color: #2ecc71; }
        .tips-operation { border-left-color: #9b59b6; }
        
        .info-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 12px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            line-height: 1.6;
        }
        
        .info-box strong {
            font-size: 13px;
            display: block;
            margin-bottom: 8px;
        }
        
        .info-box .highlight {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 12px;
            border-radius: 6px;
            margin-top: 8px;
            font-weight: 500;
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 20px;
            font-weight: 300;
        }
    </style>
</head>
<body class="login-mode">
    <div class="login-container" id="loginBox">
        <h2>üîí Pr√≠stup k medic√≠nskym √∫dajom</h2>
        <input type="password" id="passInput" placeholder="Zadajte heslo" autocomplete="current-password">
        <button id="loginBtn">Prihl√°si≈• sa</button>
        <div class="error-message" id="errorMsg">Nespr√°vne heslo!</div>
        <div class="info-text">
            üí° <strong>Ako nastavi≈• vlastn√© heslo:</strong><br>
            1. Otvorte s√∫bor v textovom editore<br>
            2. N√°jdite riadok "var PASSWORD = 'zdravie'"<br>
            3. Nahraƒète zdravie vlastn√Ωm heslom<br>
            4. Ulo≈æte s√∫bor
        </div>
    </div>

    <button class="logout-btn" id="logoutBtn">Odhl√°si≈• sa</button>
    
    <div class="container" id="mainBox">
        <h1>Graf v√°hy s medic√≠nskymi udalos≈•ami</h1>
        
        <div class="info-box">
            <strong>üéØ Prelomov√Ω moment - TIPS oper√°cia (29.04. - 02.05.2025)</strong>
            Po oper√°cii nastala v√Ωrazn√° zmena stolice:
            <div class="highlight">
                ‚úì √öprava stolice - prestali hnaƒçky<br>
                ‚úì Postupn√Ω n√°rast v√°hy z minima 58,3 kg (16.03.2025)<br>
                ‚úì Stabiliz√°cia v√°hy na √∫rovni 64-67 kg<br>
                ‚úì Celkov√Ω n√°rast o viac ako 8 kg od minima
            </div>
        </div>
        
        <div class="chart-wrapper">
            <canvas id="weightChart"></canvas>
        </div>
        
        <div class="legend">
            <div class="legend-item endoscopy">
                <div class="legend-color" style="background: #3498db;"></div>
                <div class="legend-text">
                    <strong>Endoskopia:</strong><br>
                    20.11.2024
                </div>
            </div>
            
            <div class="legend-item diarrhea">
                <div class="legend-color" style="background: #f39c12;"></div>
                <div class="legend-text">
                    <strong>Hnaƒçka:</strong><br>
                    25.11.2024 (1x dnes zaregistrovan√°)
                </div>
            </div>
            
            <div class="legend-item hospitalization">
                <div class="legend-color" style="background: #e74c3c;"></div>
                <div class="legend-text">
                    <strong>Hospitaliz√°cie:</strong><br>
                    ‚Ä¢ 05.12.2024 - 13.12.2024<br>
                    Hospitaliz√°cia z d√¥vodu hnaƒçiek<br>
                    KDD Detsk√° fakultn√° nemocnica Ko≈°ice<br>
                    <br>
                    ‚Ä¢ 29.04.2025 - 02.05.2025<br>
                    Hospitaliz√°cia z d√¥vodu zavedenia TIPS<br>
                    FNsP F. D. Roosevelta Bansk√° Bystrica
                </div>
            </div>
            
            <div class="legend-item medication">
                <div class="legend-color" style="background: #2ecc71;"></div>
                <div class="legend-text">
                    <strong>Lieky:</strong><br>
                    ‚Ä¢ 27.02.2025 - MEDOFLUCON 50mg na 7 dni<br>
                    ‚Ä¢ 07.03.2025 - UNIFLOX 0.3% 4x denne 2 kvapky<br>
                    ‚Ä¢ 08.03.2025 - MUCOSOLVAN Long Effect 1x denne<br>
                    ‚Ä¢ 13.03.2025 - PANGROL 2000 3x2tbl denne<br>
                    ‚Ä¢ 02.05.2025 - Normix 200mg 2x denne + Fraxiparine Inj 1x denne<br>
                    ‚Ä¢ 17.11.2025 10:30 - DEVIT Direct 10 000 IU 6 ml (1x vitamin D)<br>
                    ‚Ä¢ 02.12.2025 - DICYNONE 500 (1x pou≈æil, predp√≠san√© 3 balenia)
                </div>
            </div>
        </div>
    </div>

    <script src="chart-data.js"></script>
    <script src="chart-renderer.js"></script>
    <script>
        var PASSWORD = 'zdravie';
        
        document.getElementById('loginBtn').onclick = function() {
            if (document.getElementById('passInput').value === PASSWORD) {
                sessionStorage.setItem('auth', '1');
                showMain();
            } else {
                var err = document.getElementById('errorMsg');
                err.style.display = 'block';
                document.getElementById('passInput').value = '';
                setTimeout(function() { err.style.display = 'none'; }, 3000);
            }
        };

        document.getElementById('passInput').onkeypress = function(e) {
            if (e.key === 'Enter') document.getElementById('loginBtn').click();
        };

        document.getElementById('logoutBtn').onclick = function() {
            sessionStorage.removeItem('auth');
            location.reload();
        };

        function showMain() {
            document.body.className = '';
            document.getElementById('loginBox').style.display = 'none';
            document.getElementById('mainBox').style.display = 'block';
            document.getElementById('logoutBtn').style.display = 'block';
            initChart();
        }

        var data=[{date:'03.11.2024',weight:66.0,event:null},{date:'10.11.2024',weight:66.2,event:null},{date:'17.11.2024',weight:66.8,event:null},{date:'20.11.2024',weight:null,event:'Endoskopia'},{date:'25.11.2024',weight:65.6,event:'Hnacka (1x dnes zaregistrovana)'},{date:'01.12.2024',weight:64.1,event:null},{date:'05.12.2024',weight:64.3,event:'HOSPITALIZACIA zaciatok'},{date:'13.12.2024',weight:62.8,event:'HOSPITALIZACIA koniec'},{date:'16.12.2024',weight:63.4,event:null},{date:'19.12.2024',weight:62.3,event:null},{date:'22.12.2024',weight:62.6,event:null},{date:'27.12.2024',weight:62.0,event:null},{date:'29.12.2024',weight:62.1,event:null},{date:'05.01.2025',weight:62.0,event:null},{date:'12.01.2025',weight:61.5,event:null},{date:'19.01.2025',weight:60.7,event:null},{date:'26.01.2025',weight:61.1,event:null},{date:'02.02.2025',weight:60.1,event:null},{date:'09.02.2025',weight:60.3,event:null},{date:'16.02.2025',weight:60.3,event:null},{date:'23.02.2025',weight:60.0,event:null},{date:'27.02.2025',weight:null,event:'MEDOFLUCON 50mg na 7 dni'},{date:'02.03.2025',weight:59.5,event:null},{date:'07.03.2025',weight:null,event:'UNIFLOX 0.3% 4x denne 2 kvapky'},{date:'08.03.2025',weight:null,event:'MUCOSOLVAN Long Effect 1x denne'},{date:'09.03.2025',weight:59.1,event:null},{date:'13.03.2025',weight:null,event:'PANGROL 2000 3x2tbl denne'},{date:'16.03.2025',weight:58.3,event:null},{date:'23.03.2025',weight:59.7,event:null},{date:'30.03.2025',weight:58.6,event:null},{date:'06.04.2025',weight:59.3,event:null},{date:'13.04.2025',weight:58.9,event:null},{date:'21.04.2025',weight:60.1,event:null},{date:'27.04.2025',weight:59.6,event:null},{date:'29.04.2025',weight:null,event:'HOSPITALIZACIA zaciatok, TIPS operacia'},{date:'02.05.2025',weight:null,event:'HOSPITALIZACIA koniec, Normix + Fraxiparine'},{date:'04.05.2025',weight:58.4,event:null},{date:'11.05.2025',weight:60.1,event:null},{date:'18.05.2025',weight:62.0,event:null},{date:'25.05.2025',weight:62.1,event:null},{date:'01.06.2025',weight:62.4,event:null},{date:'08.06.2025',weight:64.2,event:null},{date:'15.06.2025',weight:64.5,event:null},{date:'22.06.2025',weight:64.8,event:null},{date:'29.06.2025',weight:64.0,event:null},{date:'06.07.2025',weight:63.9,event:null},{date:'13.07.2025',weight:62.8,event:null},{date:'20.07.2025',weight:64.4,event:null},{date:'27.07.2025',weight:64.2,event:null},{date:'03.08.2025',weight:63.4,event:null},{date:'10.08.2025',weight:64.7,event:null},{date:'17.08.2025',weight:64.4,event:null},{date:'24.08.2025',weight:63.9,event:null},{date:'31.08.2025',weight:64.7,event:null},{date:'07.09.2025',weight:64.6,event:null},{date:'14.09.2025',weight:64.6,event:null},{date:'21.09.2025',weight:65.9,event:null},{date:'28.09.2025',weight:65.4,event:null},{date:'05.10.2025',weight:65.7,event:null},{date:'12.10.2025',weight:66.0,event:null},{date:'19.10.2025',weight:65.1,event:null},{date:'26.10.2025',weight:65.8,event:null},{date:'02.11.2025',weight:66.3,event:null},{date:'09.11.2025',weight:65.4,event:null},{date:'16.11.2025',weight:66.6,event:null},{date:'17.11.2025',weight:null,event:'DEVIT Direct 10 000 IU 6 ml (10:30) 1x vitamin D'},{date:'23.11.2025',weight:65.3,event:null},{date:'30.11.2025',weight:66.5,event:null},{date:'02.12.2025',weight:null,event:'DICYNONE 500 (1x pouzil, predpisane 3 balenia)'},{date:'07.12.2025',weight:67.6,event:null},{date:'14.12.2025',weight:66.4,event:null},{date:'21.12.2025',weight:66.3,event:null},{date:'28.12.2025',weight:66.8,event:null},{date:'04.01.2026',weight:67.2,event:null},{date:'11.01.2026',weight:66.9,event:null},{date:'18.01.2026',weight:66.9,event:null},{date:'25.01.2026',weight:67.7,event:null}];
        
        function getEventColor(e){if(!e)return'#34495e';if(e.includes('HOSPITALIZACIA')||e.includes('TIPS'))return'#e74c3c';if(e.includes('Endoskopia'))return'#3498db';if(e.includes('Hnacka'))return'#f39c12';if(e.includes('MEDOFLUCON')||e.includes('UNIFLOX')||e.includes('MUCOSOLVAN')||e.includes('PANGROL')||e.includes('Normix')||e.includes('Fraxiparine')||e.includes('DEVIT')||e.includes('DICYNONE'))return'#2ecc71';return'#34495e';}

        if (sessionStorage.getItem('auth') === '1') showMain();
        
        function initChart(){var weightData=data.filter(function(d){return d.weight!==null;});var ctx=document.getElementById('weightChart').getContext('2d');new Chart(ctx,{type:'line',data:{labels:data.map(function(d){return d.date;}),datasets:[{label:'Vaha (kg)',data:data.map(function(d){return d.weight;}),borderColor:'#2c3e50',backgroundColor:'rgba(44,62,80,0.1)',borderWidth:1.5,pointRadius:data.map(function(d){return d.weight!==null?4:0;}),pointBackgroundColor:data.map(function(d){return d.weight!==null?'#2c3e50':'transparent';}),pointBorderColor:data.map(function(d){return d.weight!==null?'#2c3e50':'transparent';}),pointHoverRadius:6,tension:0.3,spanGaps:true,fill:false}]},options:{responsive:true,maintainAspectRatio:false,interaction:{intersect:false,mode:'index'},plugins:{legend:{display:false},tooltip:{backgroundColor:'rgba(255,255,255,0.95)',titleColor:'#2c3e50',bodyColor:'#2c3e50',borderColor:'#e0e0e0',borderWidth:1,cornerRadius:8,titleFont:{size:11,weight:'bold'},bodyFont:{size:10},callbacks:{title:function(c){return c[0].label;},beforeLabel:function(c){var dp=data[c.dataIndex];if(dp.weight!==null){return'Vaha: '+dp.weight+' kg';}return null;},label:function(c){var dp=data[c.dataIndex];if(dp.event){return'Udalost: '+dp.event;}return null;}}}},scales:{x:{display:true,title:{display:true,text:'Datum',font:{size:11}},ticks:{maxRotation:45,minRotation:45,font:{size:7},autoSkip:false},grid:{color:'rgba(0,0,0,0.05)',lineWidth:0.5}},y:{display:true,title:{display:true,text:'Vaha (kg)',font:{size:11}},ticks:{font:{size:10}},grid:{color:'rgba(0,0,0,0.05)',lineWidth:0.5},min:57,max:68}}},plugins:[{afterDatasetsDraw:function(chart){var ctx=chart.ctx;var chartArea=chart.chartArea;var tipsIdx=data.findIndex(function(d){return d.date==='29.04.2025';});if(tipsIdx!==-1){var xStart=chart.scales.x.getPixelForValue(tipsIdx);ctx.save();ctx.fillStyle='rgba(155,89,182,0.08)';ctx.fillRect(xStart,chartArea.top,chartArea.right-xStart,chartArea.bottom-chartArea.top);ctx.fillStyle='#9b59b6';ctx.font='bold 10px Segoe UI';ctx.textAlign='left';ctx.fillText('Po TIPS operacii: uprava stolice + narast vahy',xStart+10,chartArea.top+20);ctx.restore();}data.forEach(function(dp,idx){if(dp.event){var x=chart.scales.x.getPixelForValue(idx);var col=getEventColor(dp.event);var isDrug=col==='#2ecc71';var dn='';if(isDrug){if(dp.event.includes('MEDOFLUCON'))dn='MEDOFLUCON';else if(dp.event.includes('UNIFLOX'))dn='UNIFLOX';else if(dp.event.includes('MUCOSOLVAN'))dn='MUCOSOLVAN';else if(dp.event.includes('PANGROL'))dn='PANGROL';else if(dp.event.includes('Normix'))dn='NORMIX+FRAX';else if(dp.event.includes('DEVIT'))dn='DEVIT D';else if(dp.event.includes('DICYNONE'))dn='DICYNONE';}var textHeight=isDrug&&dn?dn.length*6:0;ctx.save();ctx.strokeStyle=col;ctx.lineWidth=2;ctx.setLineDash([3,3]);ctx.beginPath();ctx.moveTo(x,chartArea.top);if(isDrug&&textHeight>0){ctx.lineTo(x,chartArea.bottom-textHeight-10);}else{ctx.lineTo(x,chartArea.bottom);}ctx.stroke();ctx.restore();ctx.save();ctx.fillStyle=col;ctx.beginPath();ctx.arc(x,chartArea.top+20,4,0,2*Math.PI);ctx.fill();ctx.restore();if(dn){ctx.save();ctx.translate(x+3,chartArea.bottom-5);ctx.rotate(-Math.PI/2);ctx.fillStyle=col;ctx.font='bold 8px Segoe UI';ctx.textAlign='left';ctx.fillText(dn,0,0);ctx.restore();}}});weightData.forEach(function(dp){var didx=data.findIndex(function(d){return d.date===dp.date;});var x=chart.scales.x.getPixelForValue(didx);var y=chart.scales.y.getPixelForValue(dp.weight);ctx.save();ctx.fillStyle='#2c3e50';ctx.font='7px Segoe UI';ctx.textAlign='center';var txt=dp.weight+'kg';var tw=ctx.measureText(txt).width;ctx.fillStyle='rgba(255,255,255,0.8)';ctx.fillRect(x-tw/2-2,y-18,tw+4,10);ctx.fillStyle='#2c3e50';ctx.fillText(txt,x,y-10);ctx.restore();});data.forEach(function(dp,idx){if(dp.event){var x=chart.scales.x.getPixelForValue(idx);var col=getEventColor(dp.event);var et='';if(dp.event.includes('Endoskopia')){et='ENDOSKOPIA';}else if(dp.event.includes('Hnacka')){et='HNACKA';}else if(dp.event.includes('HOSPITALIZACIA')){if(dp.event.includes('zaciatok')){et='HOSPITALIZACIA ‚ñ∫';}else if(dp.event.includes('koniec')){et='‚óÑ HOSPITALIZACIA';}}else if(dp.event.includes('MEDOFLUCON')||dp.event.includes('UNIFLOX')||dp.event.includes('MUCOSOLVAN')||dp.event.includes('PANGROL')||dp.event.includes('Normix')||dp.event.includes('DEVIT')||dp.event.includes('DICYNONE')){et='LIEKY';}if(et){ctx.save();ctx.fillStyle=col;ctx.font='bold 8px Segoe UI';ctx.textAlign='center';var tw=ctx.measureText(et).width;ctx.fillStyle='rgba(255,255,255,0.9)';ctx.fillRect(x-tw/2-4,chartArea.top+30,tw+8,16);ctx.fillStyle=col;ctx.fillText(et,x,chartArea.top+42);ctx.restore();}}});}}]});}
    </script>
</body>
</html>